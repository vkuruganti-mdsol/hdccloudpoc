#author: Vas Kuruganti
#!/bin/env python
import datetime
from common.methods import create_decom_job_for_servers
from jobs.models import Job
from utilities.logger import ThreadLogger
from utilities.mail import send_mail
from utilities.mail import InvalidConfigurationException
import sys
import time
from orders.models import Order
from infrastructure.models import Environment
from servicecatalog.models import ServiceItem
from services.models import Service
from time import gmtime, strftime
logger = ThreadLogger(__name__)

def run(order, job=None, logger=None):

    owner = order.owner
    group = order.group
    link = order.get_absolute_url()
    reason = order.denied_reason
    time = strftime("%Y-%m-%d %H:%M:%S", gmtime())


    #email=['hdcgreen-admins@mdsol.com']
    email=['amohindra@mdsol.com',  'pkuruganti@mdsol.com', 'mgandhi@mdsol.com']
    #email='hdcgreen-admins@mdsol.com'
    subject = "CloudBolt Order Requested By {} was denied".format(owner)
    body= "The cloudbolt request with the following details was denied \n\n{}\n\nRequestor: {} \n\nRequest time: {} \n\nRequest URL: http://hdccloudpoc.mdsol.com{} \n\nReason for Denial: {}".format(order, owner, time, link, reason)
    try:
        send_mail(subject, body, None, email)
    except InvalidConfigurationException:
        logger.debug('Cannot connect to email (SMTP) server')

    return "", "", ""


def debug(message, logger):
    if logger:
        logger.debug(message)
    else:
        print message

